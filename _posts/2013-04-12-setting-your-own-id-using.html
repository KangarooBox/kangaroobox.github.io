---
layout: post
title: Setting your own ID using AWS::Record::HashModel
date: '2013-04-12T14:35:00.000-04:00'
author: Richard Hurt
tags: Ruby Deprecated Monkey_Patch DynamoDB AWS
comments: true
modified_time: '2014-06-06T12:47:02.801-04:00'
blogger_id: tag:blogger.com,1999:blog-5693054744995313095.post-9186298709661334955
blogger_orig_url: http://kangaroobox.blogspot.com/2013/04/setting-your-own-id-using.html
permalink: 2013/04/setting-your-own-id-using.html
permalink: 2013/04/setting-your-own-id-using.html
---

<h3><b>June 2014 Update: This no longer works with the newer versions of the AWS SDK. &nbsp;This information is retained merely for historical reasons and you should not use the code below. &nbsp;You have been warned.</b></h3><br />In a recent project I needed to save things to DynamoDB and be able to use my own values for the ID.  The problem is that by default <a href="http://docs.aws.amazon.com/AWSRubySDK/latest/AWS/Record/HashModel.html">AWS::Record::HashModel</a> sets the ID field for you automatically and you can't change it.  I asked about it on the <a href="https://forums.aws.amazon.com/thread.jspa?messageID=442089#442089">official AWS forums</a> and the answer was that it can't be done.  At least not yet.<br /><br />So I had to come up with a solution myself.  It's not pretty, but <a href="http://en.wikipedia.org/wiki/Monkey_patch">Monkey Patching</a> does come in handy sometimes.  So, for any others out there who are trying to solve the same problem, he's what I did.<br /><ol><li>Create a <code>monkey_patch.rb</code> file somewhere in your project where it will be loaded after the main AWS Gem.</li><li>Add the following code to the <code>monkey_patch.rb</code> file:<br /><br /><pre class="brush:ruby">module AWS<br />  module Record<br />    module AbstractBase<br />      module InstanceMethods<br /><br />        # Allow the user to override the ID<br />        def populate_id<br />          @_id = @_data['id'] || UUIDTools::UUID.random_create.to_s.downcase<br />        end<br />      end<br />    end<br />  end<br />end<br /></pre><br /></li><li>Add an "id" field to your <code>AWS::Record::HashModel</code> object.<br /><br /><pre class="brush:ruby">class MyModel &lt; AWS::Record::HashModel     <br />    string_attr   :id     <br />    ... <br />end <br /></pre><br /></li><li>Now, whenever you call the create method on MyModel if you provide an ID in the hash then it will get used as the hash_key value.  <br /><br /><pre class="brush:ruby">MyModel.create{:id =&gt; "some_value_that_I_make_up"}</pre></li></ol><br />Two things to be aware of, though:<br /><ol><li>You have to add some other attributes to the model before it will be persisted properly.  Just having an "id" won't cause it to save properly.</li><li>It's up to you to ensure that you don't create multiple models with the same ID.</li></ol>
